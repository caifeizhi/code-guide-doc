局部变量 
=========================



**在语句块开始处（由** **{}** **组成）声明变量，强制要求简单变量声明时就初始化** 。

OceanBase 认为需要在每个语句块（由{}组成）的开始处声明局部变量，这样的代码的可读性较好。另外，允许局部变量在 for 循环语句块的开头声明，如 `for(int
i = 0; i < 10; ++i)` 。如果声明变量和使用变量的地方相隔较远，说明语句块包含的代码过多，这往往意味着需要进行代码重构。

在循环体内声明变量，如果变量是一个对象，每次循环都要先后调用其构造函数和析构函数，每次循环也需要圧栈和弹栈，因此将这样的变量提取到循环外要高效得多。 **禁止在循环体内声明非简单变量（例如类变量），** 如果必须违反，请事先征得小组负责人的同意，并详细注释原因。出于代码可读性的考虑，允许在循环内声明引用。

```cpp
// 低效的实现
for (int i = 0; i < 100000; ++i) {
  ObFoo f;  // 每次进入循环都要调用构造函数和析构函数
  f.do_something();
}
 
// 高效的实现
ObFoo f;
for (int i = 0; i < 100000; ++i) {
  f.do_something();
}
 
//出于代码可读性的考虑，可以在循环内声明引用
for(int i = 0; i < N; ++i) {
   const T &t = very_long_variable_name.at(i);
   t.f1();
   t.f2();
   ...
}
```



此外，OceanBase 对局部变量的大小进行限制，不建议定义过大的局部变量。

1. 函数栈不超过 32K。

   

2. 单个局部变量不超过 8K。

   



